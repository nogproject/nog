# Package `nog-error-2`

## Introduction

Package `nog-error-2` provides `nogthrow()` to raise errors that work well with
Meteor.

`nog-error-2` is mostly compatible with the non-legacy API of `nog-error`.
A notable difference is that `nog-error-2` does not use a logging collection by
default; see source `nog-error-2/index-server.js` for details.

Meteor provides a mechanism to prevent server-side errors from being sent to
the client:

* Only errors of type `Meteor.Error` are directly sent to the client.
* Errors of a different type are reported to the server log and either
  a generic error 500 is sent to the client or the content of the field
  `sanitizedError` if it contains a `Meteor.Error`.

`nog-error-2` provides functions to maintain four information streams: `{full,
sanitized} x {user, developer}`.  `reason` contains information that can be
displayed to users as is.  `details` contains information for developers.  The
error type `NogError.Error` is used on the server.  The `sanitizedError` is
reported to the client.

Errors are created from a spec.  See package `nog-error` for examples.

## `nog-error-2.nogthrow(spec, context)` (anywhere)

`nogthrow(spec, context)` throws a new error object.  It uses the general
structure from `spec` and the situation-specific information from `context`.
If `context` has a field `cause`, it will be used to derive an error history,
which simply is an array of the previous causes.  The error object is of type
`NogError.Error` with a `sanitizedError` of type `Meteor.Error` to be reported
to the client.

A `spec` has the following fields:

 - `errorCode` (`String`, by convention all uppercase `ERR_<topic>_<details>`)
   identifies the type of error.
 - `statusCode` (`Number`) is a HTTP status code that is used if the error is
   reported via HTTP (from the REST API).
 - `reason` (`String | (context) -> String`): Text that explains the reasons
   (for a user); either static or generated by a function.
 - `details` (`String | (context) -> String`): Text that explains the details
   (for a developer); either static or generated by a function.
 - `contextPattern` (`Match Pattern`): A Meteor match pattern that is used to
   validate the `context` object.  A warning is reported to the console, if the
   pattern does not match.
 - `sanitized` (`null | 'full' | Object`) controls how the sanitized error for
   the client is constructed.  For `null`, an unspecified error with code
   `NOGERR` will be used.  For `full`, the complete information that is
   available on the server will be used.  `sanitized` can also be an Object
   with the following optional fields `{errorCode: String, reason: String
   | (context) -> String, details: String | (context) -> String}`) to control
   the details.

`context` is an optional object to provide information about the context in
which the error occurred.  The context information will be used when creating
the error object:

 - `reason` (String, optional): A message for the user that overrides the
   default message from the specs.
 - `details` (String, optional): A detailed message to developers that
   overrides the default message from the specs.
 - `cause` (Error, optional): Will be used to derive an error history.
 - Some specs require further fields that are used to construct the messages.
