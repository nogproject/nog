

<!--
DO NOT EDIT.
This file has been automatically generated by gen-apidoc-nog-blob-upload.
-->

## Upload Blob Data

Uploading data requires a sequence of coordinated requests.  The upload starts
with a `POST`, which returns an upload id and descriptions how parts should be
upload to S3.  Depending on the total upload size, multiple parts need to be
uploaded to S3.  More upload parts should be requested only when needed and
used immediately, because the S3 URLs expire after a couple of minutes.  After
uploading the binary data to S3, the upload is completed by posting the `ETag`
headers that S3 returned to the completion href that has been returned by the
initial `POST`.

### Start Upload

```
POST /repos/:repoOwner/:repoName/db/blobs/:sha1/uploads?limit=:limit
```

The sha1 of the file is specified in the path.

`:limit` is used to restrict the number of upload parts that are initially
returned.  Use a limit of 1 if your upload code works sequentially.  You may
use a larger number if your upload code handles multiple concurrent uploads to
S3.

**Request body**

 - `size` (`Number`): The file size.
 - `name` (`String`): The local file name.

Example:

```
POST https://nog.zib.de/api/repos/fred/hello-world/db/blobs/4c187d0d3e1df64c6e6365be78c13c276ff4cba4/uploads?limit=1
```

```json
{
  "name": "testdata.dat",
  "size": 6000000
}
```

**Response**

```
Status: 201
```

```json
{
  "data": {
    "parts": {
      "count": 2,
      "items": [
        {
          "end": 5242880,
          "href": "https://some-s3-bucket.amazonaws.com/4c187d0d3e1df64c6e6365be78c13c276ff4cba4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKXXXXXXXXXXXXXXXXXX%2F20160218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20160218T060332Z&X-Amz-Expires=900&X-Amz-Signature=f470a86511de484d603f743d911d2ecf250248d47ac5214ae5cc670fa717aae2&X-Amz-SignedHeaders=host&partNumber=1&uploadId=JbzKJWaG0.Q8kcQFLrb0wwfG_VNTq_ZT_W9JqtPtEyrob6RKKBiAXGRH717QwqzPvJopYTgCDD_2rfhwPjDnpiYkVE17fvSS6hIDFQkOyxwb.y5UT8hGJM4dGFbj8SO1",
          "partNumber": 1,
          "start": 0
        }
      ],
      "limit": 1,
      "next": "https://nog.zib.de/api/repos/fred/hello-world/db/blobs/4c187d0d3e1df64c6e6365be78c13c276ff4cba4/uploads/JbzKJWaG0.Q8kcQFLrb0wwfG_VNTq_ZT_W9JqtPtEyrob6RKKBiAXGRH717QwqzPvJopYTgCDD_2rfhwPjDnpiYkVE17fvSS6hIDFQkOyxwb.y5UT8hGJM4dGFbj8SO1/parts?offset=1&limit=1",
      "offset": 0
    },
    "upload": {
      "href": "https://nog.zib.de/api/repos/fred/hello-world/db/blobs/4c187d0d3e1df64c6e6365be78c13c276ff4cba4/uploads/JbzKJWaG0.Q8kcQFLrb0wwfG_VNTq_ZT_W9JqtPtEyrob6RKKBiAXGRH717QwqzPvJopYTgCDD_2rfhwPjDnpiYkVE17fvSS6hIDFQkOyxwb.y5UT8hGJM4dGFbj8SO1",
      "id": "JbzKJWaG0.Q8kcQFLrb0wwfG_VNTq_ZT_W9JqtPtEyrob6RKKBiAXGRH717QwqzPvJopYTgCDD_2rfhwPjDnpiYkVE17fvSS6hIDFQkOyxwb.y5UT8hGJM4dGFbj8SO1"
    }
  },
  "statusCode": 201
}
```




### Upload Individual Parts to S3

```
PUT <data.parts.items[n].href>
```

Binary data for each part must be send to S3 using `PUT`.  The data slice for
each part is specified as `[start; end[` in the part descriptions.  The start
is inclusive; the end is exclusive.

Pay attention to the indexing: S3 part numbers start with index 1.  The
pagination starts with index 0.

Example:

```
PUT https://some-s3-bucket.amazonaws.com/4c187d0d3e1df64c6e6365be78c13c276ff4cba4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKXXXXXXXXXXXXXXXXXX%2F20160218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20160218T060355Z&X-Amz-Expires=900&X-Amz-Signature=fb376d6652691e44a0c28627d7adb1d0daaca97e5ca210f0a833498bab9bf721&X-Amz-SignedHeaders=host&partNumber=2&uploadId=JbzKJWaG0.Q8kcQFLrb0wwfG_VNTq_ZT_W9JqtPtEyrob6RKKBiAXGRH717QwqzPvJopYTgCDD_2rfhwPjDnpiYkVE17fvSS6hIDFQkOyxwb.y5UT8hGJM4dGFbj8SO1

Body with binary data for [start; end[
```

**Response**

```
Status: 200
ETag: "a6c5e0b78ec35e11070a7350daa82211"
```




### Get Additional Part Descriptions

```
GET <parts.next>
```

More parts can be retrieved from the `next` href of the previous parts.  The
URL automatically uses the same limit as the initial request.

An alternative is to explicitly construct the URL to get more parts:

```
GET /repos/:repoOwner/:repoName/db/blobs/:sha1/uploads/:uploadId?offset=:offset&limit=:limit
```

Example:

```
GET https://nog.zib.de/api/repos/fred/hello-world/db/blobs/4c187d0d3e1df64c6e6365be78c13c276ff4cba4/uploads/JbzKJWaG0.Q8kcQFLrb0wwfG_VNTq_ZT_W9JqtPtEyrob6RKKBiAXGRH717QwqzPvJopYTgCDD_2rfhwPjDnpiYkVE17fvSS6hIDFQkOyxwb.y5UT8hGJM4dGFbj8SO1/parts?offset=1&limit=1
```

**Response**

```
Status: 200
```

```json
{
  "data": {
    "count": 2,
    "items": [
      {
        "end": 6000000,
        "href": "https://some-s3-bucket.amazonaws.com/4c187d0d3e1df64c6e6365be78c13c276ff4cba4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKXXXXXXXXXXXXXXXXXX%2F20160218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20160218T060355Z&X-Amz-Expires=900&X-Amz-Signature=fb376d6652691e44a0c28627d7adb1d0daaca97e5ca210f0a833498bab9bf721&X-Amz-SignedHeaders=host&partNumber=2&uploadId=JbzKJWaG0.Q8kcQFLrb0wwfG_VNTq_ZT_W9JqtPtEyrob6RKKBiAXGRH717QwqzPvJopYTgCDD_2rfhwPjDnpiYkVE17fvSS6hIDFQkOyxwb.y5UT8hGJM4dGFbj8SO1",
        "partNumber": 2,
        "start": 5242880
      }
    ],
    "limit": 1,
    "next": null,
    "offset": 1
  },
  "statusCode": 200
}
```




### Complete the Upload

The upload is completed by a `POST` to the href that has been returned as
`upload.href` when starting the upload.

```
POST <upload.href>
```

The format is:

```
POST /repos/:repoOwner/:repoName/db/blobs/:sha1/uploads/:uploadId
```

Example:

```
POST https://nog.zib.de/api/repos/fred/hello-world/db/blobs/4c187d0d3e1df64c6e6365be78c13c276ff4cba4/uploads/JbzKJWaG0.Q8kcQFLrb0wwfG_VNTq_ZT_W9JqtPtEyrob6RKKBiAXGRH717QwqzPvJopYTgCDD_2rfhwPjDnpiYkVE17fvSS6hIDFQkOyxwb.y5UT8hGJM4dGFbj8SO1
```

**Request body**

The body contains a field `s3Parts` with an array with the part numbers and
ETag headers returned by S3.

Example:

```json
{
  "s3Parts": [
    {
      "ETag": "\"8220aff7f4c6452a8e7f8cd1be261365\"",
      "PartNumber": 1
    },
    {
      "ETag": "\"a6c5e0b78ec35e11070a7350daa82211\"",
      "PartNumber": 2
    }
  ]
}
```

**Response**

```
Status: 201
```

```json
{
  "data": {
    "_id": {
      "href": "https://nog.zib.de/api/repos/fred/hello-world/db/blobs/4c187d0d3e1df64c6e6365be78c13c276ff4cba4",
      "id": "4c187d0d3e1df64c6e6365be78c13c276ff4cba4"
    },
    "content": {
      "href": "https://some-s3-bucket.amazonaws.com/4c187d0d3e1df64c6e6365be78c13c276ff4cba4?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKXXXXXXXXXXXXXXXXXX%2F20160218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20160218T060401Z&X-Amz-Expires=900&X-Amz-Signature=8ac8c68a1f72db5a4e4e03c443f095b2dc6236d3f4a0a3803d888c1e6c8e7414&X-Amz-SignedHeaders=host&response-content-disposition=attachment%3B%20filename%3D%224c187d0d3e1df64c6e6365be78c13c276ff4cba4.dat%22"
    },
    "sha1": "4c187d0d3e1df64c6e6365be78c13c276ff4cba4",
    "size": 6000000,
    "status": "available"
  },
  "statusCode": 201
}
```


